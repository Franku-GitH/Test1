::Set CDP and AIA locations variables
SET URLbase1=http://pki.vz.gov.cz/pki
SET URLbase2=http://pki.dod.gov.cz/pki

:: Configure CDP and AIA
certutil -setreg CA\CRLPublicationURLs "65:%windir%\system32\Certsrv\CertEnroll\%%3%%8%%9.crl\n79:ldap:///CN=%%7%%8,CN=%%2,CN=CDP,CN=Public Key Services,CN=Services,%%6%%10\n6:%URLbase1%/%%3%%8%%%9.crl\n6:%URLbase2%/%%3%%8%%%9.crl"

certutil -setreg CA\CACertPublicationURLs "1:%WINDIR%\system32\CertSrv\CertEnroll\%%1_%%3%%4.crt\n2:%AIA1%/%%3%%4.crt"
certutil -setreg CA\CACertPublicationURLs "1:%windir%\system32\Certsrv\CertEnroll\%%3%%8.crt\n2:%URLbase1%/%%3%%8.crt\n2:%URLbase2%/%%3%%8.crt"

::Set CRL publishing period & disable DeltaCRL
certutil -setreg CA\CRLPeriodUnits 7
certutil -setreg CA\CRLPeriod "Days"
certutil -setreg CA\CRLDeltaPeriodUnits 0

::Set CRL publishing overlap period
certutil -setreg CA\CRLOverlapUnits 2
certutil -setreg CA\CRLOverlapPeriod "Days"

::Set validity period for issued certificates
certutil -setreg ca\ValidityPeriodUnits 1
certutil -setreg ca\ValidityPeriod "Years"

::Configure CA to audit all events
certutil -setreg CA\Auditfilter 127

::Restart CA and publish new CRL
net stop certsvc & net start certsvc
pause
certutil -CRL
pause
